<!DOCTYPE html>
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>04 - Read-only versus Writable R Objects ‚Ä¢ cpp4r</title><link rel="stylesheet" href="../menu.css"><link rel="stylesheet" href="../content.css"><!-- MathJax Configuration --><script>
    window.MathJax = {
      tex: {
        inlineMath: [['\\(', '\\)'], ['$', '$']],
        displayMath: [['\\[', '\\]'], ['$$', '$$']],
        processEscapes: true,
        processEnvironments: true,
        packages: {'[+]': ['ams', 'newcommand', 'configmacros']}
      },
      options: {
        ignoreHtmlClass: 'tex2jax_ignore',
        processHtmlClass: 'tex2jax_process'
      }
    };
  </script><script id="MathJax-script" async src="../js/tex-svg.js"></script></head><body>
<div class="main-container">
<div id="menu">
  <div>
    <img src="../man/figures/logo.svg" align="center" height="139" alt="cpp4r logo"></div>

  <div class="search-container">
    <input type="text" id="search-box" placeholder="Search..."></div>

  <div class="search-container">
    <button id="theme-toggle" title="Toggle dark mode" aria-label="Toggle dark mode">Toggle theme</button>
    <button id="font-decrease" title="Decrease font size" aria-label="Decrease font size">A-</button>
    <button id="font-increase" title="Increase font size" aria-label="Increase font size">A+</button>
  </div>

  <div class="submenu">
    <label style="border-bottom: 0;"><a style="padding-left: 0;" href="../index.html">Home üè†</a></label>
  </div>

  <div class="submenu">
    <label>Functions</label>
    <a href="../reference/register.html">register</a>
    <a href="../reference/pkg_template.html">pkg_template</a>
    <a href="../reference/unvendor.html">unvendor</a>
    <a href="../reference/vendor.html">vendor</a>
  </div>

  <div class="submenu">
    <label>Vignettes</label>
    <a href="../vignettes/01-motivations.html">01 - Motivations for cpp4r</a>
    <a href="../vignettes/02-setup.html">02 - Setup</a>
    <a href="../vignettes/03-package-skeleton.html">03 - Package Skeleton</a>
    <a href="../vignettes/04-read-only.html">04 - Read-only versus Writable R Objects</a>
    <a href="../vignettes/05-logical-functions.html">05 - Logical Functions</a>
    <a href="../vignettes/06-rolling-functions.html">06 - Rolling Functions</a>
    <a href="../vignettes/07-statistical-functions.html">07 - Statistical Functions</a>
    <a href="../vignettes/08-logical-functions-2.html">08 - Logical Functions with Missing Values</a>
    <a href="../vignettes/09-rolling-functions-2.html">09 - Rolling Functions with Missing Values</a>
    <a href="../vignettes/10-statistical-functions-2.html">10 - Statistical Functions with Missing Values</a>
    <a href="../vignettes/11-debugging.html">11 - Debugging R Packages</a>
    <a href="../vignettes/12-external-pointers.html">12 - External Pointers</a>
    <a href="../vignettes/13-compiler-optimization.html">13 - Compiler Optimizations</a>
    <a href="../vignettes/14-linear-algebra.html">14 - Linear Algebra</a>
    <a href="../vignettes/15-internals.html">15 - Internals</a>
    <a href="../vignettes/16-FAQ.html">17 - FAQs</a>
    <a href="../vignettes/17-worked-examples.html">16 - Worked Examples</a>
  </div>

  <div class="submenu">
    <label>News</label>
    <a href="../news/index.html">Changelog</a>
  </div>
</div>
<div id="content">
<div class="content-wrapper">
<div class="content-main">
<h1>04 - Read-only versus Writable R Objects</h1>



<div id="read-and-write" class="section level1">
<h1>Read and write</h1>
<p>In <code>cpp4r</code>, when you declare a variable, it is read-only
by default as in cpp11 <span class="citation">(Vaughan, Hester, and
Francois 2024)</span>. This is different from <code>Rcpp</code>, where
variables are read-write by default <span class="citation">(Eddelbuettel
and Francois 2011)</span>.</p>
<p>Following from the package created in the previous vignette, try to
compile and run the following code by adding it to a new file
<code>src/04_square_coordinates.h</code>:</p>
<pre class="cpp"><code>[[cpp4r::register]]
integers square_coordinates_(integers x) {
  integers out = x;
  for (int i = 0; i &lt; x.size(); ++i) {
    out[i] = x[i] * x[i];
  }
  return out;
}</code></pre>
<p><code>devtools::load_all()</code> and
<code>devtools::install()</code> will fail with the following error:</p>
<pre class="bash"><code>error: lvalue required as left operand of assignment
  out[i] = x[i] * x[i];</code></pre>
<p>This is because the argument <code>x</code> is a read-only object,
you need to explicitly declare a writable variable:</p>
<pre class="cpp"><code>[[cpp4r::register]]
integers square_coordinates(integers x) {
  writable::integers out = x;
  for (int i = 0; i &lt; x.size(); ++i) {
    out[i] = x[i] * x[i];
  }
  return out;
}</code></pre>
<p>Alternatively, you can declare the argument as writable:</p>
<pre class="cpp"><code>[[cpp4r::register]]
integers square_coordinates_2(writable::integers x) {
  for (int i = 0; i &lt; x.size(); ++i) {
    x[i] = x[i] * x[i];
  }
  return x;
}</code></pre>
<p>Do not forget to include the new header file in
<code>main.cpp</code>:</p>
<p>Document these functions with roxygen and compare their outputs after
loading the updated package:</p>
<pre class="r"><code>cpp4r::register()
devtools::document()
devtools::load_all()</code></pre>
<p>Compare <code>square_coordinates(1:3)</code>,
<code>square_coordinates(c(1, 2, 3))</code>, and
<code>square_coordinates(c(1L, 2L, 3L))</code>. Why do the outputs
differ? Are <code>integers</code> and <code>doubles</code>
interchangeable as <code>double</code> and <code>int</code> in C++ for
reasonable cases?</p>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="unnumbered">References</h1>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-eddelbuettel11" class="csl-entry">
Eddelbuettel, Dirk, and Romain Francois. 2011. <span>‚ÄúRcpp:
<span>Seamless</span> <span>R</span> and <span>C++</span>
<span>Integration</span>.‚Äù</span> <em>Journal of Statistical
Software</em> 40 (April): 1‚Äì18. <a href="https://doi.org/10.18637/jss.v040.i08">https://doi.org/10.18637/jss.v040.i08</a>.
</div>
<div id="ref-vaughan24" class="csl-entry">
Vaughan, Davis, Jim Hester, and Roman Francois. 2024. <span>‚ÄúGet Started
with Cpp11.‚Äù</span> <a href="https://cpp11.r-lib.org/articles/cpp11.html#intro">https://cpp11.r-lib.org/articles/cpp11.html#intro</a>.
</div>
</div>
</div>
</div>
<footer><p id="last-updated">Loading...</p>
</footer><script src="../js/footer.js"></script><script src="../js/theme.js"></script><script src="../js/search.js"></script><script src="../js/fontsize.js"></script></div>
</div>
</div>
</body></html>

