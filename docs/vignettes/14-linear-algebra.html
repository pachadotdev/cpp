<!DOCTYPE html>
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>14 - Linear Algebra ‚Ä¢ cpp4r</title><link rel="stylesheet" href="../menu.css"><link rel="stylesheet" href="../content.css"><!-- MathJax Configuration --><script>
    window.MathJax = {
      tex: {
        inlineMath: [['\\(', '\\)'], ['$', '$']],
        displayMath: [['\\[', '\\]'], ['$$', '$$']],
        processEscapes: true,
        processEnvironments: true,
        packages: {'[+]': ['ams', 'newcommand', 'configmacros']}
      },
      svg: {
        fontCache: 'global',
        scale: 1.5,  /* Scale SVG math to 150% */
        minScale: 0.5,
        mtextInheritFont: false,
        merrorInheritFont: true,
        mathmlSpacing: false,
        exFactor: 0.5  /* Adjust baseline for better alignment */
      },
      options: {
        ignoreHtmlClass: 'tex2jax_ignore',
        processHtmlClass: 'tex2jax_process'
      }
    };
  </script><script id="MathJax-script" async src="../js/tex-svg.js"></script></head><body>
<div class="main-container">
<div id="menu">
  <div>
    <img src="../man/figures/logo.svg" align="center" height="139" alt="cpp4r logo"></div>

  <div class="search-container">
    <input type="text" id="search-box" placeholder="Search..."><button id="theme-toggle" title="Toggle dark mode" aria-label="Toggle dark mode">üí°</button>
  </div>

  <div class="submenu">
    <label style="border-bottom: 0;"><a style="padding-left: 0;" href="../index.html">Home üè†</a></label>
  </div>

  <div class="submenu">
    <label>Functions</label>
    <a href="../reference/register.html">register</a>
    <a href="../reference/pkg_template.html">pkg_template</a>
    <a href="../reference/unvendor.html">unvendor</a>
    <a href="../reference/vendor.html">vendor</a>
  </div>

  <div class="submenu">
    <label>Vignettes</label>
    <a href="../vignettes/01-motivations.html">01 - Motivations for cpp4r</a>
    <a href="../vignettes/02-setup.html">02 - Setup</a>
    <a href="../vignettes/03-package-skeleton.html">03 - Package Skeleton</a>
    <a href="../vignettes/04-read-only.html">04 - Read-only versus Writable R Objects</a>
    <a href="../vignettes/05-logical-functions.html">05 - Logical Functions</a>
    <a href="../vignettes/06-rolling-functions.html">06 - Rolling Functions</a>
    <a href="../vignettes/07-statistical-functions.html">07 - Statistical Functions</a>
    <a href="../vignettes/08-logical-functions-2.html">08 - Logical Functions with Missing Values</a>
    <a href="../vignettes/09-rolling-functions-2.html">09 - Rolling Functions with Missing Values</a>
    <a href="../vignettes/10-statistical-functions-2.html">10 - Statistical Functions with Missing Values</a>
    <a href="../vignettes/11-debugging.html">11 - Debugging R Packages</a>
    <a href="../vignettes/12-external-pointers.html">12 - External Pointers</a>
    <a href="../vignettes/13-compiler-optimization.html">13 - Compiler Optimizations</a>
    <a href="../vignettes/14-linear-algebra.html">14 - Linear Algebra</a>
    <a href="../vignettes/15-internals.html">15 - Internals</a>
    <a href="../vignettes/16-FAQ.html">17 - FAQs</a>
    <a href="../vignettes/17-worked-examples.html">16 - Worked Examples</a>
  </div>

  <div class="submenu">
    <label>News</label>
    <a href="../news/index.html">Changelog</a>
  </div>
</div>
<div id="content">
<div class="content-wrapper">
<div class="content-main">
<h1>14 - Linear Algebra</h1>



<div id="motivation" class="section level1">
<h1>Motivation</h1>
<p>R provides out-of-box support for matrices and vectors. This is not
the case for C++ code, where you need to use a library such as <a href="https://arma.sourceforge.net/">Armadillo</a> that has a wrapper
for R <span class="citation">(Vargas Sepulveda and Schneider Malamud
2025)</span>. One of the nicest Armadillo features is that it has a
similar syntax to MATLAB.</p>
</div>
<div id="using-armadillo" class="section level1">
<h1>Using Armadillo</h1>
<p><a href="https://pacha.dev/cpp11armadillo/">cpp11armadillo</a>
provides a detailed R-specific documentation with worked examples.</p>
<p>Because the examples in the cpp11armadillo are self-contained and
with detailed explanations, this vignette will not repeat them here.</p>
<p>Here is one of the over five-hundred examples from the cpp11armadillo
package to compute <span class="math inline">\(\hat{\beta} =
(X^TX)^{-1}X^Ty\)</span> for a linear model using the cpp4r concepts
already covered:</p>
<pre class="cpp"><code>Mat&lt;double&gt; ols_(const doubles_matrix&lt;&gt;&amp; y, const doubles_matrix&lt;&gt;&amp; x) {
  Mat&lt;double&gt; Y = as_Mat(y);  // Col&lt;double&gt; Y = as_Col(y); also works
  Mat&lt;double&gt; X = as_Mat(x);

  Mat&lt;double&gt; XtX = X.t() * X;             // X'X
  Mat&lt;double&gt; XtX_inv = inv(XtX);          // (X'X)^(-1)
  Mat&lt;double&gt; beta = XtX_inv * X.t() * Y;  // (X'X)^(-1)(X'Y)

  return beta;
}

[[cpp4r::register]] doubles_matrix&lt;&gt; ols_mat_(const doubles_matrix&lt;&gt;&amp; y,
                                              const doubles_matrix&lt;&gt;&amp; x) {
  Mat&lt;double&gt; beta = ols_(y, x);
  return as_doubles_matrix(beta);
}

[[cpp4r::register]] doubles ols_dbl_(const doubles_matrix&lt;&gt;&amp; y,
                                     const doubles_matrix&lt;&gt;&amp; x) {
  Mat&lt;double&gt; beta = ols_(y, x);
  return as_doubles(beta);
}</code></pre>
<p>One of the advantages of cpp11armadillo is that it connects cpp11
(and cpp4r) with Armadillo, allowing you to use the
<code>as_Mat()</code> and <code>as_doubles_matrix()</code> functions as
the ‚Äúbread‚Äù of the sandwich, where pure Armadillo code serves as the
‚Äúmeat‚Äù.</p>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="unnumbered">References</h1>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-vargassepulveda25" class="csl-entry">
Vargas Sepulveda, Mauricio, and Jonathan Schneider Malamud. 2025.
<span>‚ÄúCpp11armadillo: <span>An</span> <span>R</span> Package to Use the
<span>Armadillo</span> <span>C</span>++ Library.‚Äù</span>
<em>SoftwareX</em> 30 (May): 102087. <a href="https://doi.org/10.1016/j.softx.2025.102087">https://doi.org/10.1016/j.softx.2025.102087</a>.
</div>
</div>
</div>
</div>
<footer><p>Last updated: 2025-10-12 22:30:24</p>
</footer><script>
document.addEventListener('DOMContentLoaded', function() {
  // Theme toggle functionality
  const themeToggle = document.getElementById('theme-toggle');
  const currentTheme = localStorage.getItem('theme') || 'light';

  // Apply saved theme
  document.documentElement.setAttribute('data-theme', currentTheme);

  if (themeToggle) {
    themeToggle.addEventListener('click', function() {
      const currentTheme = document.documentElement.getAttribute('data-theme');
      const newTheme = currentTheme === 'dark' ? 'light' : 'dark';

      document.documentElement.setAttribute('data-theme', newTheme);
      localStorage.setItem('theme', newTheme);
    });
  }

  // Search functionality
  const searchBox = document.getElementById('search-box');
  if (!searchBox) return;

  let searchIndex = [];

  // Load search index
  fetch('../search.json')
    .then(response => response.json())
    .then(data => {
      searchIndex = data;
    })
    .catch(error => {
      console.log('Search index not available, falling back to simple search');
    });

  searchBox.addEventListener('input', function() {
    const searchTerm = this.value.toLowerCase().trim();

    if (searchTerm === '') {
      // Show all items when search is empty
      document.querySelectorAll('#menu .submenu a').forEach(function(link) {
        link.style.display = 'block';
      });
      document.querySelectorAll('#menu .submenu').forEach(function(submenu) {
        submenu.style.display = 'block';
      });
      return;
    }

    // Content-based search using search index
    if (searchIndex.length > 0) {
      const matchingUrls = new Set();

      searchIndex.forEach(function(item) {
        const searchContent = (item.title + ' ' + item.content).toLowerCase();
        if (searchContent.includes(searchTerm)) {
          matchingUrls.add(item.url);
        }
      });

      // Show/hide links based on content matches
      document.querySelectorAll('#menu .submenu a').forEach(function(link) {
        const href = link.getAttribute('href');
        const relativePath = href.replace(/^.*\//, ''); // Get just the filename part

        let isMatch = false;
        matchingUrls.forEach(function(url) {
          if (url.includes(relativePath)) {
            isMatch = true;
          }
        });

        // Also check link text for simple matches
        if (!isMatch && link.textContent.toLowerCase().includes(searchTerm)) {
          isMatch = true;
        }

        link.style.display = isMatch ? 'block' : 'none';
      });
    } else {
      // Fallback to simple name-based search
      document.querySelectorAll('#menu .submenu a').forEach(function(link) {
        const linkText = link.textContent.toLowerCase();
        link.style.display = linkText.includes(searchTerm) ? 'block' : 'none';
      });
    }

    // Show/hide entire submenus if no visible links
    document.querySelectorAll('#menu .submenu').forEach(function(submenu) {
      const visibleLinks = submenu.querySelectorAll('a[style*="display: block"]');
      const label = submenu.querySelector('label');

      // Don't hide the Home submenu
      if (label && label.textContent.includes('Home')) {
        return;
      }

      submenu.style.display = visibleLinks.length > 0 ? 'block' : 'none';
    });
  });
});
</script></div>
</div>
</div>
</body></html>

