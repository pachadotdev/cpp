<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>16 - Worked Examples • cpp4r</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="16 - Worked Examples">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">cpp4r</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/01-motivations.html">01 - Motivations for cpp4r</a></li>
    <li><a class="dropdown-item" href="../articles/02-setup.html">02 - Setup</a></li>
    <li><a class="dropdown-item" href="../articles/03-package-skeleton.html">03 - Package Skeleton</a></li>
    <li><a class="dropdown-item" href="../articles/04-read-only.html">04 - Read-only versus Writable R Objects</a></li>
    <li><a class="dropdown-item" href="../articles/05-logical-functions.html">05 - Logical Functions</a></li>
    <li><a class="dropdown-item" href="../articles/06-rolling-functions.html">06 - Rolling Functions</a></li>
    <li><a class="dropdown-item" href="../articles/07-statistical-functions.html">07 - Statistical Functions</a></li>
    <li><a class="dropdown-item" href="../articles/08-logical-functions-2.html">08 - Logical Functions with Missing Values</a></li>
    <li><a class="dropdown-item" href="../articles/09-rolling-functions-2.html">09 - Rolling Functions with Missing Values</a></li>
    <li><a class="dropdown-item" href="../articles/10-statistical-functions-2.html">10 - Statistical Functions with Missing Values</a></li>
    <li><a class="dropdown-item" href="../articles/11-debugging.html">11 - Debugging R Packages</a></li>
    <li><a class="dropdown-item" href="../articles/12-external-pointers.html">12 - External Pointers</a></li>
    <li><a class="dropdown-item" href="../articles/13-compiler-optimization.html">13 - Compiler Optimizations</a></li>
    <li><a class="dropdown-item" href="../articles/14-linear-algebra.html">14 - Linear Algebra</a></li>
    <li><a class="dropdown-item" href="../articles/15-internals.html">15 - Internals</a></li>
    <li><a class="dropdown-item" href="../articles/16-FAQ.html">17 - FAQs</a></li>
    <li><a class="dropdown-item" href="../articles/17-worked-examples.html">16 - Worked Examples</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="nav-link" href="https://github.com/pachadotdev/cpp4r/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>16 - Worked Examples</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/pachadotdev/cpp4r/blob/HEAD/vignettes/17-worked-examples.Rmd"><code>vignettes/17-worked-examples.Rmd</code></a></small>
      <div class="d-none name"><code>17-worked-examples.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="motivation">Motivation<a class="anchor" aria-label="anchor" href="#motivation"></a>
</h2>
<p>The previous package skeleton left out some essential details, such
as testing for memory leaks and debugging. This vignette will cover
these aspects in more detail. The references for this vignette are <span class="citation">(<strong>vaughan?</strong>)</span>, <span class="citation">(<strong>padgham?</strong>)</span>, <span class="citation">(<strong>vaughan2?</strong>)</span>, and <span class="citation">(<strong>wickham?</strong>)</span>.</p>
</div>
<div class="section level2">
<h2 id="instructional-examples">Instructional examples<a class="anchor" aria-label="anchor" href="#instructional-examples"></a>
</h2>
<div class="section level3">
<h3 id="solving-a-matrix-using-the-gauss-jordan-method">Solving a matrix using the Gauss-Jordan method<a class="anchor" aria-label="anchor" href="#solving-a-matrix-using-the-gauss-jordan-method"></a>
</h3>
<p>This example package covers the following topics:</p>
<ul>
<li>Integers</li>
<li>Doubles</li>
<li>Matrices</li>
<li>Conditionals</li>
<li>Loops (<code>for</code>)</li>
<li>Vendoring</li>
</ul>
<p>See the <a href="https://github.com/pachadotdev/cpp4r/tree/main/cpp4rgaussjordan">cpp4rgaussjordan</a>
package.</p>
<div class="section level4">
<h4 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a>
</h4>
<p>This implementation is a naive approach, but it can be used, for
example, to obtain the Ordinary Least Squares (OLS) estimator as shown
in the next section.</p>
<p>Vendoring means that the dependency code, the <code>cpp4r</code> C++
headers, are copied the project’s source tree. This ensures the
dependency code is fixed and stable until it is updated.</p>
<p>The advantage of vendoring is that changes to the <code>cpp4r</code>
package could never break the package’s code. The disadvantage is that
fixes and new features will be available after vendoring the code
again.</p>
</div>
<div class="section level4">
<h4 id="vendoring">Vendoring<a class="anchor" aria-label="anchor" href="#vendoring"></a>
</h4>
<p>You can start with
<code>create_package("~/github/cpp4rgaussjordan")</code>. You can use
VSCode, but all the steps also apply to RStudio.</p>
<p>After opening <code>~/github/cpp4rgaussjordan</code>, you can run
<code>use_cpp4r()</code> to have a readily available skeleton in your
project.</p>
<p>You can run <code>use_apache_licence()</code> to have a
<code>LICENSE</code> file and indicate in <code>DESCRIPTION</code> that
your package is distributed under the Apache License.</p>
<p>Then you can run <code>cpp_vendor()</code> to copy the C++ headers
into <code>inst/include</code>.</p>
</div>
<div class="section level4">
<h4 id="building-and-testing">Building and testing<a class="anchor" aria-label="anchor" href="#building-and-testing"></a>
</h4>
<p>You can use <code>devtools</code> to build and test the package:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="co"># build</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">clean_dll</span>()</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>cpp4r<span class="sc">::</span><span class="fu">cpp_register</span>()</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">document</span>()</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">load_all</span>()</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="co"># test</span></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a>A <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">3</span>,<span class="sc">-</span><span class="dv">1</span>), <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a><span class="fu">invert_matrix</span>(A)</span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">invert_matrix</span>(A)</span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a>     [,<span class="dv">1</span>] [,<span class="dv">2</span>]</span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a>[<span class="dv">1</span>,]  <span class="fl">0.2</span>  <span class="fl">0.6</span></span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a>[<span class="dv">2</span>,]  <span class="fl">0.2</span> <span class="sc">-</span><span class="fl">0.4</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="ordinary-least-squares-ols-estimator">Ordinary Least Squares (OLS) estimator<a class="anchor" aria-label="anchor" href="#ordinary-least-squares-ols-estimator"></a>
</h3>
<p>This example package covers the following topics:</p>
<ul>
<li>Integers</li>
<li>Doubles</li>
<li>Doubles matrices</li>
<li>Conditionals</li>
</ul>
<p>See the <a href="https://github.com/pachadotdev/cpp4r/tree/main/cpp4rols">cpp4rols</a>
package.</p>
<p>This implementation is extremely naive, quite similar to the
Gauss-Jordan example with extra steps, and it is enough to show how to
use C++ code within R.</p>
<p>One approach is to create one function per step, which means creating
one function to obtain
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>X</mi><mi>t</mi></msup><mi>X</mi></mrow><annotation encoding="application/x-tex">X^tX</annotation></semantics></math>,
another for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>X</mi><mi>t</mi></msup><mi>X</mi><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mi>−</mi><mn>1</mn></mrow></msup><annotation encoding="application/x-tex">(X^tX)^{-1}</annotation></semantics></math>
(e.g, implementing the Gauss-Jordan method to invert a matrix), another
for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>X</mi><mi>t</mi></msup><mi>Y</mi></mrow><annotation encoding="application/x-tex">X^tY</annotation></semantics></math>
and then calling each of those functions to obtain
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover><mi>β</mi><mo accent="true">̂</mo></mover><mo>=</mo><msup><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>X</mi><mi>t</mi></msup><mi>X</mi><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mi>−</mi><mn>1</mn></mrow></msup><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>X</mi><mi>t</mi></msup><mi>Y</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\hat{\beta} = (X^tX)^{-1}(X^tY)</annotation></semantics></math>.</p>
<p>A good challenge would be to implement the QR decomposition used by
the <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code> function in R and use it to obtain the OLS
estimator in C++. <span class="citation">(<strong>drury?</strong>)</span> provides a good
starting point, this is not trivial to implement.</p>
<p>It is hard to beat the performance of the <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code> function
in R, which calls compiled C and FORTRAN functions, and these functions
are fast and robust <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code>.</p>
</div>
<div class="section level3">
<h3 id="linear-programming-simplex-phase-2">Linear programming (Simplex phase 2)<a class="anchor" aria-label="anchor" href="#linear-programming-simplex-phase-2"></a>
</h3>
<p>This example package covers the following topics:</p>
<ul>
<li>Integers</li>
<li>Doubles</li>
<li>Doubles matrices</li>
<li>Conditionals</li>
<li>Loops (<code>for</code> and <code>while</code>)</li>
<li>Messages</li>
</ul>
<p>See the <a href="https://github.com/pachadotdev/cpp4r/tree/main/cpp4rsimplexphase2">cpp4rsimplex</a>
package.</p>
<div class="section level4">
<h4 id="algorithm">Algorithm<a class="anchor" aria-label="anchor" href="#algorithm"></a>
</h4>
<p>The simplex algorithm is well described in <a href="http://athenasc.com/linoptbook.html">Introduction to Linear
Optimization</a> and there is efficient software to solve this,
including <span class="citation">(<strong>lpsolve?</strong>)</span>.</p>
<p>A problem written in canonical form is represented by a table such
as:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>x</mi><mn>1</mn></msub></mtd><mtd columnalign="center" style="text-align: center"><mi>⋯</mi></mtd><mtd columnalign="center" style="text-align: center"><msub><mi>x</mi><mi>n</mi></msub></mtd><mtd columnalign="center" style="text-align: center"></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>c</mi><mn>1</mn></msub></mtd><mtd columnalign="center" style="text-align: center"><mi>⋯</mi></mtd><mtd columnalign="center" style="text-align: center"><msub><mi>c</mi><mi>n</mi></msub></mtd><mtd columnalign="center" style="text-align: center"><mi>−</mi><mi>z</mi></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>a</mi><mn>11</mn></msub></mtd><mtd columnalign="center" style="text-align: center"><mi>⋯</mi></mtd><mtd columnalign="center" style="text-align: center"><msub><mi>a</mi><mrow><mn>1</mn><mi>n</mi></mrow></msub></mtd><mtd columnalign="center" style="text-align: center"><msub><mi>b</mi><mn>1</mn></msub></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><mi>⋮</mi></mtd><mtd columnalign="center" style="text-align: center"><mo>⋱</mo></mtd><mtd columnalign="center" style="text-align: center"><mi>⋮</mi></mtd><mtd columnalign="center" style="text-align: center"><mi>⋮</mi></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>a</mi><mrow><mi>m</mi><mn>1</mn></mrow></msub></mtd><mtd columnalign="center" style="text-align: center"><mi>⋯</mi></mtd><mtd columnalign="center" style="text-align: center"><msub><mi>a</mi><mrow><mi>m</mi><mi>n</mi></mrow></msub></mtd><mtd columnalign="center" style="text-align: center"><msub><mi>b</mi><mi>m</mi></msub></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{array}{ccc|c}
x_1 &amp; \cdots &amp; x_n &amp; \\
\hline
c_1 &amp; \cdots &amp; c_n &amp; -z \\
a_{11} &amp; \cdots &amp; a_{1n} &amp; b_1 \\
\vdots &amp; \ddots &amp; \vdots &amp; \vdots \\
a_{m1} &amp; \cdots &amp; a_{mn} &amp; b_m
\end{array}
</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>c</mi><mn>1</mn></msub><mo>,</mo><mi>…</mi><mo>,</mo><msub><mi>c</mi><mi>n</mi></msub></mrow><annotation encoding="application/x-tex">c_1, \ldots, c_n</annotation></semantics></math>
are the coefficients of the objective function (i.e., costs),
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mn>11</mn></msub><mo>,</mo><mi>…</mi><mo>,</mo><msub><mi>a</mi><mrow><mi>m</mi><mi>n</mi></mrow></msub></mrow><annotation encoding="application/x-tex">a_{11}, \ldots, a_{mn}</annotation></semantics></math>
are the coefficients of the constraints, and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>b</mi><mn>1</mn></msub><mo>,</mo><mi>…</mi><mo>,</mo><msub><mi>b</mi><mi>m</mi></msub></mrow><annotation encoding="application/x-tex">b_1, \ldots, b_m</annotation></semantics></math>
are the right-hand side of the constraints.</p>
<p>The simplex algorithm to solve the problem consists in the next
steps:</p>
<ol style="list-style-type: decimal">
<li>If
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>c</mi><mi>j</mi></msub><mo>≥</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">c_j \geq 0</annotation></semantics></math>
for all
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>,
then the current solution is optimal. Basic variables are equal to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>b</mi><mi>i</mi></msub><annotation encoding="application/x-tex">b_i</annotation></semantics></math>
and non-basic variables are equal to 0.</li>
<li>If
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>c</mi><mi>j</mi></msub><mo>&lt;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">c_j &lt; 0</annotation></semantics></math>
for some
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>,
choose it to enter the base. Choose the variable with the most negative
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>c</mi><mi>j</mi></msub><annotation encoding="application/x-tex">c_j</annotation></semantics></math>,
and assume that it is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi><mo>=</mo><mi>s</mi></mrow><annotation encoding="application/x-tex">j = s</annotation></semantics></math>.</li>
<li>If
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mrow><mi>i</mi><mi>s</mi></mrow></msub><mo>≤</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">a_{is} \leq 0</annotation></semantics></math>
for all
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>,
then the problem is unbounded.</li>
<li>If
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mrow><mi>i</mi><mi>s</mi></mrow></msub><mo>&gt;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">a_{is} &gt; 0</annotation></semantics></math>
for some
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>,
choose
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mo>=</mo><mi>r</mi></mrow><annotation encoding="application/x-tex">i = r</annotation></semantics></math>
such that
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><msub><mi>b</mi><mi>r</mi></msub><msub><mi>a</mi><mrow><mi>r</mi><mi>s</mi></mrow></msub></mfrac><mo>=</mo><mo>min</mo><mrow><mo stretchy="true" form="prefix">(</mo><mfrac><msub><mi>b</mi><mi>i</mi></msub><mrow><msub><mi>a</mi><mi>i</mi></msub><mi>s</mi></mrow></mfrac><mo>,</mo><mspace width="0.222em"></mspace><msub><mi>a</mi><mrow><mi>i</mi><mi>s</mi></mrow></msub><mn>0</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\frac{b_r}{a_{rs}} = \min(\frac{b_i}{a_is},\: a_{is} 0)</annotation></semantics></math>
and pivot on
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>a</mi><mrow><mi>r</mi><mi>s</mi></mrow></msub><annotation encoding="application/x-tex">a_{rs}</annotation></semantics></math>,
to then go back to step 1.</li>
</ol>
<p>The coefficients are updated according to:</p>
<ol style="list-style-type: decimal">
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>←</mo><msub><mi>a</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>−</mo><mfrac><mrow><msub><mi>a</mi><mrow><mi>i</mi><mi>s</mi></mrow></msub><msub><mi>a</mi><mrow><mi>r</mi><mi>j</mi></mrow></msub></mrow><msub><mi>a</mi><mrow><mi>r</mi><mi>s</mi></mrow></msub></mfrac></mrow><annotation encoding="application/x-tex">a_{ij} \leftarrow a_{ij} - \frac{a_{is} a_{rj}}{a_{rs}}</annotation></semantics></math>
for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi><mo>≠</mo><mi>s</mi></mrow><annotation encoding="application/x-tex">j \neq s</annotation></semantics></math>
</li>
<li><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mrow><mi>r</mi><mi>j</mi></mrow></msub><mo>←</mo><mfrac><msub><mi>a</mi><mrow><mi>r</mi><mi>j</mi></mrow></msub><msub><mi>a</mi><mrow><mi>r</mi><mi>s</mi></mrow></msub></mfrac></mrow><annotation encoding="application/x-tex">a_{rj} \leftarrow \frac{a_{rj}}{a_{rs}}</annotation></semantics></math></li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>b</mi><mi>i</mi></msub><mo>←</mo><msub><mi>b</mi><mi>i</mi></msub><mo>−</mo><mfrac><mrow><msub><mi>a</mi><mrow><mi>i</mi><mi>s</mi></mrow></msub><msub><mi>b</mi><mi>r</mi></msub></mrow><msub><mi>a</mi><mrow><mi>r</mi><mi>s</mi></mrow></msub></mfrac></mrow><annotation encoding="application/x-tex">b_i \leftarrow b_i - \frac{a_{is} b_r}{a_{rs}}</annotation></semantics></math>
for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mo>≠</mo><mi>r</mi></mrow><annotation encoding="application/x-tex">i \neq r</annotation></semantics></math>
</li>
<li><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>b</mi><mi>r</mi></msub><mo>←</mo><mfrac><msub><mi>b</mi><mi>r</mi></msub><msub><mi>a</mi><mrow><mi>r</mi><mi>s</mi></mrow></msub></mfrac></mrow><annotation encoding="application/x-tex">b_r \leftarrow \frac{b_r}{a_{rs}}</annotation></semantics></math></li>
<li><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>c</mi><mi>j</mi></msub><mo>←</mo><msub><mi>c</mi><mi>j</mi></msub><mo>−</mo><mfrac><mrow><msub><mi>c</mi><mi>s</mi></msub><msub><mi>a</mi><mrow><mi>r</mi><mi>j</mi></mrow></msub></mrow><msub><mi>a</mi><mrow><mi>r</mi><mi>s</mi></mrow></msub></mfrac></mrow><annotation encoding="application/x-tex">c_j \leftarrow c_j - \frac{c_s a_{rj}}{a_{rs}}</annotation></semantics></math></li>
<li><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>−</mi><mi>z</mi><mo>←</mo><mi>−</mi><mi>z</mi><mo>−</mo><mfrac><mrow><msub><mi>c</mi><mi>s</mi></msub><msub><mi>b</mi><mi>r</mi></msub></mrow><msub><mi>a</mi><mrow><mi>r</mi><mi>s</mi></mrow></msub></mfrac></mrow><annotation encoding="application/x-tex">-z \leftarrow -z - \frac{c_s b_r}{a_{rs}}</annotation></semantics></math></li>
</ol>
<p>This algorithm is equivalent to Gauss method to solve linear
systems.</p>
</div>
<div class="section level4">
<h4 id="numerical-example">Numerical example<a class="anchor" aria-label="anchor" href="#numerical-example"></a>
</h4>
<p>A simple example is the following minimization problem:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mtext mathvariant="normal">min</mtext><mspace width="1.0em"></mspace></mtd><mtd columnalign="left" style="text-align: left"><mi>−</mi><msub><mi>x</mi><mn>1</mn></msub><mo>−</mo><mn>3</mn><msub><mi>x</mi><mn>2</mn></msub></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><mtext mathvariant="normal">subject to</mtext><mspace width="1.0em"></mspace></mtd><mtd columnalign="left" style="text-align: left"><msub><mi>x</mi><mn>1</mn></msub><mo>+</mo><msub><mi>x</mi><mn>2</mn></msub><mo>≥</mo><mn>3</mn></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mi>−</mi><mn>3</mn><msub><mi>x</mi><mn>1</mn></msub><mo>+</mo><msub><mi>x</mi><mn>2</mn></msub><mo>≥</mo><mn>2</mn></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><msub><mi>x</mi><mn>1</mn></msub><mo>,</mo><msub><mi>x</mi><mn>2</mn></msub><mo>≥</mo><mn>0</mn></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{aligned}
\text{min} \quad &amp; -x_1 - 3x_2 \\
\text{subject to} \quad &amp; x_1 + x_2 \geq 3 \\
&amp; -3x_1 + x_2 \geq 2 \\
&amp; x_1, x_2 \geq 0
\end{aligned}
</annotation></semantics></math></p>
<p>In canonical form, this problem is:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mtext mathvariant="normal">min</mtext><mspace width="1.0em"></mspace></mtd><mtd columnalign="left" style="text-align: left"><mi>−</mi><msub><mi>x</mi><mn>1</mn></msub><mo>−</mo><mn>3</mn><msub><mi>x</mi><mn>2</mn></msub><mo>+</mo><mn>0</mn><msub><mi>x</mi><mn>3</mn></msub><mo>+</mo><mn>0</mn><msub><mi>x</mi><mn>4</mn></msub></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><mtext mathvariant="normal">subject to</mtext><mspace width="1.0em"></mspace></mtd><mtd columnalign="left" style="text-align: left"><msub><mi>x</mi><mn>1</mn></msub><mo>+</mo><msub><mi>x</mi><mn>2</mn></msub><mo>+</mo><msub><mi>x</mi><mn>3</mn></msub><mo>=</mo><mn>3</mn></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mi>−</mi><mn>3</mn><msub><mi>x</mi><mn>1</mn></msub><mo>+</mo><msub><mi>x</mi><mn>2</mn></msub><mo>+</mo><msub><mi>x</mi><mn>4</mn></msub><mo>=</mo><mn>2</mn></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><msub><mi>x</mi><mn>1</mn></msub><mo>,</mo><msub><mi>x</mi><mn>2</mn></msub><mo>,</mo><msub><mi>x</mi><mn>3</mn></msub><mo>,</mo><msub><mi>x</mi><mn>4</mn></msub><mo>≥</mo><mn>0</mn></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{aligned}
\text{min} \quad &amp; -x_1 - 3x_2 + 0x_3 + 0x_4 \\
\text{subject to} \quad &amp; x_1 + x_2 + x_3 = 3 \\
&amp; -3x_1 + x_2 + x_4 = 2 \\
&amp; x_1, x_2,x_3,x_4 \geq 0
\end{aligned}
</annotation></semantics></math></p>
<p>The initial tableau for the problem is:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>x</mi><mn>1</mn></msub></mtd><mtd columnalign="center" style="text-align: center"><msub><mi>x</mi><mn>2</mn></msub></mtd><mtd columnalign="center" style="text-align: center"><msub><mi>x</mi><mn>3</mn></msub></mtd><mtd columnalign="center" style="text-align: center"><msub><mi>x</mi><mn>4</mn></msub></mtd><mtd columnalign="center" style="text-align: center"><mi>−</mi><mi>z</mi></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><mi>−</mi><mn>1</mn></mtd><mtd columnalign="center" style="text-align: center"><mi>−</mi><mn>3</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>0</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>0</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>0</mn></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><mn>1</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>1</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>1</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>0</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>3</mn></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><mi>−</mi><mn>3</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>1</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>0</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>1</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>2</mn></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{array}{cccc|c}
x_1 &amp; x_2 &amp; x_3 &amp; x_4 &amp; -z \\
\hline
-1 &amp; -3 &amp; 0 &amp; 0 &amp; 0 \\
1 &amp; 1 &amp; 1 &amp; 0 &amp; 3 \\
-3 &amp; 1 &amp; 0 &amp; 1 &amp; 2
\end{array}
</annotation></semantics></math></p>
<p>The first row is the cost row, the last column is the right-hand
side, and the rest is the matrix
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>A</mi><annotation encoding="application/x-tex">A</annotation></semantics></math>.</p>
<p>The first step is to pivot on row 2 and column 2:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>x</mi><mn>1</mn></msub></mtd><mtd columnalign="center" style="text-align: center"><msub><mi>x</mi><mn>2</mn></msub></mtd><mtd columnalign="center" style="text-align: center"><msub><mi>x</mi><mn>3</mn></msub></mtd><mtd columnalign="center" style="text-align: center"><msub><mi>x</mi><mn>4</mn></msub></mtd><mtd columnalign="center" style="text-align: center"><mi>−</mi><mi>z</mi></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><mi>−</mi><mn>10</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>0</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>0</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>3</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>6</mn></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><mn>4</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>0</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>1</mn></mtd><mtd columnalign="center" style="text-align: center"><mi>−</mi><mn>1</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>1</mn></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><mi>−</mi><mn>3</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>1</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>0</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>1</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>2</mn></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{array}{cccc|c}
x_1 &amp; x_2 &amp; x_3 &amp; x_4 &amp; -z \\
\hline
-10 &amp; 0 &amp; 0 &amp; 3 &amp; 6 \\
4 &amp; 0 &amp; 1 &amp; -1 &amp; 1 \\
-3 &amp; 1 &amp; 0 &amp; 1 &amp; 2
\end{array}
</annotation></semantics></math></p>
<p>The second step is to pivot on row 2 and column 1:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>x</mi><mn>1</mn></msub></mtd><mtd columnalign="center" style="text-align: center"><msub><mi>x</mi><mn>2</mn></msub></mtd><mtd columnalign="center" style="text-align: center"><msub><mi>x</mi><mn>3</mn></msub></mtd><mtd columnalign="center" style="text-align: center"><msub><mi>x</mi><mn>4</mn></msub></mtd><mtd columnalign="center" style="text-align: center"><mi>−</mi><mi>z</mi></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><mn>0</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>0</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>5</mn><mi>/</mi><mn>2</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>1</mn><mi>/</mi><mn>2</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>17</mn><mi>/</mi><mn>2</mn></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><mn>1</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>0</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>1</mn><mi>/</mi><mn>4</mn></mtd><mtd columnalign="center" style="text-align: center"><mi>−</mi><mn>1</mn><mi>/</mi><mn>4</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>1</mn><mi>/</mi><mn>4</mn></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><mn>0</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>1</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>3</mn><mi>/</mi><mn>4</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>1</mn><mi>/</mi><mn>4</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>11</mn><mi>/</mi><mn>4</mn></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{array}{cccc|c}
x_1 &amp; x_2 &amp; x_3 &amp; x_4 &amp; -z \\
\hline
0 &amp; 0 &amp; 5/2 &amp; 1/2 &amp; 17/2 \\
1 &amp; 0 &amp; 1/4 &amp; -1/4 &amp; 1/4 \\
0 &amp; 1 &amp; 3/4 &amp; 1/4 &amp; 11/4
\end{array}
</annotation></semantics></math></p>
<p>Here a stopping criterion is reached: the minimum cost is
non-negative, therefore the solution is optimal and is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>x</mi><mo>*</mo></msup><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><mfrac><mn>1</mn><mn>4</mn></mfrac><mo>,</mo><mfrac><mn>11</mn><mn>4</mn></mfrac><mo>,</mo><mn>0</mn><mo>,</mo><mn>0</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">x^* = (\frac{1}{4}, \frac{11}{4}, 0 , 0)</annotation></semantics></math>
with an optimal value
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>z</mi><mo>*</mo></msup><mo>=</mo><mi>−</mi><mfrac><mn>17</mn><mn>2</mn></mfrac></mrow><annotation encoding="application/x-tex">z^* = -\frac{17}{2}</annotation></semantics></math>.</p>
</div>
<div class="section level4">
<h4 id="building-and-testing-1">Building and testing<a class="anchor" aria-label="anchor" href="#building-and-testing-1"></a>
</h4>
<p>You can use <code>devtools</code> to build and test the package:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># build</span></span>
<span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://pkgbuild.r-lib.org/reference/clean_dll.html">clean_dll</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu">cpp4r</span><span class="fu">::</span><span class="fu">cpp_register</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org/reference/document.html">document</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org/reference/load_all.html">load_all</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># test</span></span>
<span></span>
<span><span class="va">c</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">A</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">3</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>    nrow <span class="op">=</span> <span class="fl">2</span>,</span>
<span>    ncol <span class="op">=</span> <span class="fl">2</span>,</span>
<span>    byrow <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">cpp4r_simplex_phase2</span><span class="op">(</span><span class="va">c</span>, <span class="va">b</span>, <span class="va">A</span><span class="op">)</span></span></code></pre></div>
<p>The result should be:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>Initial tableau<span class="sc">:</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="sc">-</span><span class="dv">1</span> <span class="sc">-</span><span class="dv">3</span>  <span class="dv">0</span>  <span class="dv">0</span>  <span class="dv">0</span> </span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a> <span class="dv">1</span>  <span class="dv">1</span>  <span class="dv">1</span>  <span class="dv">0</span>  <span class="dv">3</span> </span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a><span class="sc">-</span><span class="dv">3</span>  <span class="dv">1</span>  <span class="dv">0</span>  <span class="dv">1</span>  <span class="dv">2</span> </span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>Minimum cost<span class="sc">:</span> <span class="sc">-</span><span class="dv">3</span></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>Pivot row<span class="sc">:</span> <span class="dv">2</span></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>Pivot column<span class="sc">:</span> <span class="dv">2</span></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a><span class="sc">==</span><span class="er">==</span></span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a>New tableau<span class="sc">:</span></span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a><span class="sc">-</span><span class="dv">10</span>  <span class="dv">0</span>  <span class="dv">0</span>  <span class="dv">3</span>  <span class="dv">6</span> </span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a> <span class="dv">4</span>  <span class="dv">0</span>  <span class="dv">1</span> <span class="sc">-</span><span class="dv">1</span>  <span class="dv">1</span> </span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a><span class="sc">-</span><span class="dv">3</span>  <span class="dv">1</span>  <span class="dv">0</span>  <span class="dv">1</span>  <span class="dv">2</span> </span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a>Minimum cost<span class="sc">:</span> <span class="sc">-</span><span class="dv">10</span></span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a>Pivot row<span class="sc">:</span> <span class="dv">1</span></span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a>Pivot column<span class="sc">:</span> <span class="dv">1</span></span>
<span id="cb3-16"><a href="#cb3-16" tabindex="-1"></a><span class="sc">==</span><span class="er">==</span></span>
<span id="cb3-17"><a href="#cb3-17" tabindex="-1"></a>New tableau<span class="sc">:</span></span>
<span id="cb3-18"><a href="#cb3-18" tabindex="-1"></a> <span class="dv">0</span>  <span class="dv">0</span>  <span class="fl">2.5</span>  <span class="fl">0.5</span>  <span class="fl">8.5</span> </span>
<span id="cb3-19"><a href="#cb3-19" tabindex="-1"></a> <span class="dv">1</span>  <span class="dv">0</span>  <span class="fl">0.25</span> <span class="sc">-</span><span class="fl">0.25</span>  <span class="fl">0.25</span> </span>
<span id="cb3-20"><a href="#cb3-20" tabindex="-1"></a> <span class="dv">0</span>  <span class="dv">1</span>  <span class="fl">0.75</span>  <span class="fl">0.25</span>  <span class="fl">2.75</span> </span>
<span id="cb3-21"><a href="#cb3-21" tabindex="-1"></a>Minimum cost<span class="sc">:</span> <span class="dv">0</span></span>
<span id="cb3-22"><a href="#cb3-22" tabindex="-1"></a>Optimal solution found <span class="cf">in</span> <span class="dv">2</span> steps <span class="sc">!</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="using-omp-parallelization">Using OMP (parallelization)<a class="anchor" aria-label="anchor" href="#using-omp-parallelization"></a>
</h3>
<p>This example package covers the following topics:</p>
<ul>
<li>Integers</li>
<li>Doubles</li>
<li>Lists (unnamed and named)</li>
<li>Loops (<code>for</code>)</li>
<li>OpenMP parallelization</li>
</ul>
<p>See the <a href="https://github.com/pachadotdev/cpp4r/tree/main/cpp4romp">cpp4romp</a>
package.</p>
<div class="section level4">
<h4 id="motivation-1">Motivation<a class="anchor" aria-label="anchor" href="#motivation-1"></a>
</h4>
<p>One common phrase that you might find when you need to search how to
do something with <code>cpp4r</code> is: “cpp4r does not offer OpenMP
support.” This is a myth. <code>cpp4r</code> does offer OpenMP support.
The requirements are: A processor and C++ compiler that support
OpenMP.</p>
<p>This has been tested on Windows, where you need to install <a href="https://cran.r-project.org/bin/windows/Rtools/">Rtools</a>, and
Ubuntu where you do not need anything special because the
<code>gcc</code> compiler comes with the operating system and it just
works.</p>
<p>If you are using macOS, you need to install <code>libomp</code> via
Homebrew in order to extend the <code>clang</code> compiler, and this is
explained in the <a href="https://open-box.readthedocs.io/en/latest/installation/openmp_macos.html">OpenBox
documentation</a> <span class="citation">(<strong>openbox?</strong>)</span>.</p>
</div>
<div class="section level4">
<h4 id="enabling-openmp">Enabling OpenMP<a class="anchor" aria-label="anchor" href="#enabling-openmp"></a>
</h4>
<p>You can create an R package called <code>cpp4romp</code> with the
following code:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">usethis</span><span class="fu">::</span><span class="fu"><a href="https://usethis.r-lib.org/reference/create_package.html">create_project</a></span><span class="op">(</span><span class="st">"cpp4romp"</span><span class="op">)</span></span>
<span><span class="fu">usethis</span><span class="fu">::</span><span class="fu">use_cpp4r</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Then, you can create the file <code>R/cpp4romp-package.R</code> with
the following contents:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## usethis namespace: start</span></span>
<span><span class="co">#' @useDynLib cpp4romp, .registration = TRUE</span></span>
<span><span class="co">## usethis namespace: end</span></span>
<span><span class="cn">NULL</span></span></code></pre></div>
<p>In order to get the <code>#pragma</code> instruction to work, you
need to add the following to <code>src/Makevars</code>:</p>
<pre><code>PKG_CXXFLAGS = $(SHLIB_OPENMP_CXXFLAGS) -DARMA_OPENMP_THREADS=1
PKG_LIBS = $(SHLIB_OPENMP_CXXFLAGS)
CXX_STD = CXX11</code></pre>
<p>Not adding this means that the pragma instruction will be ignored and
the functions will run in a single thread.</p>
</div>
<div class="section level4">
<h4 id="unnamed-list">Unnamed list<a class="anchor" aria-label="anchor" href="#unnamed-list"></a>
</h4>
<p>You can add a function called <code>squared_unnamed_</code> in
<code>src/code.cpp</code> that will square each element in a vector of
doubles, so the file content corresponds to the following:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;cpp4r.hpp&gt;</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;omp.h&gt;</span></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a><span class="kw">using</span> <span class="kw">namespace</span> cpp4r<span class="op">;</span></span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a><span class="op">[[</span><span class="at">cpp4r</span><span class="op">::</span><span class="at">register</span><span class="op">]]</span> list <span class="va">squared_unnamed_</span><span class="op">(</span>doubles x<span class="op">)</span> <span class="op">{</span></span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a>  <span class="co">// create vectors y = x^2 and z = thread number</span></span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a>  <span class="dt">int</span> n <span class="op">=</span> x<span class="op">.</span>size<span class="op">();</span></span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a>  writable<span class="op">::</span>doubles y<span class="op">(</span>n<span class="op">);</span></span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a>  writable<span class="op">::</span>doubles z<span class="op">(</span>n<span class="op">);</span></span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a>  </span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a>  <span class="pp">#pragma omp parallel for</span></span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> n<span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">{</span></span>
<span id="cb7-14"><a href="#cb7-14" tabindex="-1"></a>    y<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> x<span class="op">[</span>i<span class="op">]</span> <span class="op">*</span> x<span class="op">[</span>i<span class="op">];</span></span>
<span id="cb7-15"><a href="#cb7-15" tabindex="-1"></a>    z<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> omp_get_thread_num<span class="op">();</span></span>
<span id="cb7-16"><a href="#cb7-16" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb7-17"><a href="#cb7-17" tabindex="-1"></a></span>
<span id="cb7-18"><a href="#cb7-18" tabindex="-1"></a>  <span class="co">//create a list containing y and z</span></span>
<span id="cb7-19"><a href="#cb7-19" tabindex="-1"></a>  writable<span class="op">::</span>list out<span class="op">;</span></span>
<span id="cb7-20"><a href="#cb7-20" tabindex="-1"></a>  out<span class="op">.</span>push_back<span class="op">(</span>y<span class="op">);</span></span>
<span id="cb7-21"><a href="#cb7-21" tabindex="-1"></a>  out<span class="op">.</span>push_back<span class="op">(</span>z<span class="op">);</span></span>
<span id="cb7-22"><a href="#cb7-22" tabindex="-1"></a>  <span class="cf">return</span> out<span class="op">;</span></span>
<span id="cb7-23"><a href="#cb7-23" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>The previous function returns an unnamed list with two elements: the
squared vector and the thread number. The function is registered with
<code>[[cpp4r::register]]</code> so that it can be called from R.</p>
<p>C++ is strict with types, so you need to create a wrapper function
that will convert the integers to doubles to avoid accidental errors, it
will go in <code>R/cpp4romp-package.R</code>:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Unnamed list with squared numbers and the threads used</span></span>
<span><span class="co">#' @param x A vector of doubles</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">squared_unnamed</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">squared_unnamed_</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/double.html">as.double</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="named-list">Named list<a class="anchor" aria-label="anchor" href="#named-list"></a>
</h4>
<p>You can add a function called <code>squared_named_</code> in
<code>src/code.cpp</code> that does the same but returns a named list.
The additional content corresponds to the following:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="op">[[</span><span class="at">cpp4r</span><span class="op">::</span><span class="at">register</span><span class="op">]]</span> list <span class="va">squared_named_</span><span class="op">(</span>doubles x<span class="op">)</span> <span class="op">{</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>  <span class="co">// create vectors y = x^2 and z = thread number</span></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>  <span class="dt">int</span> n <span class="op">=</span> x<span class="op">.</span>size<span class="op">();</span></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a>  writable<span class="op">::</span>doubles y<span class="op">(</span>n<span class="op">);</span></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a>  writable<span class="op">::</span>doubles z<span class="op">(</span>n<span class="op">);</span></span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a>  </span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a>  <span class="pp">#pragma omp parallel for</span></span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> n<span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">{</span></span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a>    y<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> x<span class="op">[</span>i<span class="op">]</span> <span class="op">*</span> x<span class="op">[</span>i<span class="op">];</span></span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a>    z<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> omp_get_thread_num<span class="op">();</span></span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb9-12"><a href="#cb9-12" tabindex="-1"></a></span>
<span id="cb9-13"><a href="#cb9-13" tabindex="-1"></a>  <span class="co">//create a list containing y and z</span></span>
<span id="cb9-14"><a href="#cb9-14" tabindex="-1"></a>  writable<span class="op">::</span>list out<span class="op">;</span></span>
<span id="cb9-15"><a href="#cb9-15" tabindex="-1"></a>  out<span class="op">.</span>push_back<span class="op">({</span><span class="st">"x^2"</span><span class="op">_nm</span> <span class="op">=</span> y<span class="op">});</span></span>
<span id="cb9-16"><a href="#cb9-16" tabindex="-1"></a>  out<span class="op">.</span>push_back<span class="op">({</span><span class="st">"thread"</span><span class="op">_nm</span> <span class="op">=</span> z<span class="op">});</span></span>
<span id="cb9-17"><a href="#cb9-17" tabindex="-1"></a>  <span class="cf">return</span> out<span class="op">;</span></span>
<span id="cb9-18"><a href="#cb9-18" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>As in the previous part, you can add a wrapper and documentation:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Named list with squared numbers and the threads used</span></span>
<span><span class="co">#' @param x A vector of doubles</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">squared_named</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">squared_named_</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/double.html">as.double</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="building-and-testing-2">Building and testing<a class="anchor" aria-label="anchor" href="#building-and-testing-2"></a>
</h4>
<p>You can use <code>devtools</code> to build and test the package:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">cpp4r</span><span class="fu">::</span><span class="fu">cpp_register</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org/reference/document.html">document</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org/reference/install.html">install</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Then, you can test the package from a new R session:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">library</span>(cpp4romp)</span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">squared_unnamed</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>[[<span class="dv">1</span>]]</span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a> [<span class="dv">1</span>]   <span class="dv">1</span>   <span class="dv">4</span>   <span class="dv">9</span>  <span class="dv">16</span>  <span class="dv">25</span>  <span class="dv">36</span>  <span class="dv">49</span>  <span class="dv">64</span>  <span class="dv">81</span> <span class="dv">100</span></span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a>[[<span class="dv">2</span>]]</span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a> [<span class="dv">1</span>] <span class="dv">0</span> <span class="dv">0</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">2</span> <span class="dv">3</span> <span class="dv">4</span> <span class="dv">5</span> <span class="dv">6</span> <span class="dv">7</span></span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">squared_named</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a><span class="sc">$</span><span class="st">`</span><span class="at">x^2</span><span class="st">`</span></span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a> [<span class="dv">1</span>]   <span class="dv">1</span>   <span class="dv">4</span>   <span class="dv">9</span>  <span class="dv">16</span>  <span class="dv">25</span>  <span class="dv">36</span>  <span class="dv">49</span>  <span class="dv">64</span>  <span class="dv">81</span> <span class="dv">100</span></span>
<span id="cb12-12"><a href="#cb12-12" tabindex="-1"></a></span>
<span id="cb12-13"><a href="#cb12-13" tabindex="-1"></a><span class="sc">$</span>thread</span>
<span id="cb12-14"><a href="#cb12-14" tabindex="-1"></a> [<span class="dv">1</span>] <span class="dv">0</span> <span class="dv">0</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">2</span> <span class="dv">3</span> <span class="dv">4</span> <span class="dv">5</span> <span class="dv">6</span> <span class="dv">7</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="implementing-a-rejection-and-bootstrap-sampler">Implementing a rejection and bootstrap sampler<a class="anchor" aria-label="anchor" href="#implementing-a-rejection-and-bootstrap-sampler"></a>
</h3>
<p>This example package covers the following topics:</p>
<ul>
<li>Integers</li>
<li>Doubles</li>
<li>Matrices</li>
<li>Push back</li>
<li>Random seed state</li>
</ul>
<p>See the differences between cpp11, cpp4r and Rcpp:</p>
<ul>
<li>
<a href="https://github.com/pachadotdev/cpp4r/tree/main/cpp11sampling">cpp11sampling</a>
package.</li>
<li>
<a href="https://github.com/pachadotdev/cpp4r/tree/main/cpp4rsampling">cpp4rsampling</a>
package.</li>
<li>
<a href="https://github.com/pachadotdev/cpp4r/tree/main/Rcppsampling">Rcppsampling</a>
package.</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="extensive-rc-tests">Extensive R/C++ tests<a class="anchor" aria-label="anchor" href="#extensive-rc-tests"></a>
</h2>
<p>See the <a href="https://github.com/pachadotdev/cpp4r/tree/main/cpp4rtest">cpp4rtest</a>
package. It covers over 1,000 unit tests for <code>cpp4r</code>
features, including:</p>
<ul>
<li>Vectors (integers, doubles, logicals, strings)</li>
<li>Matrices (integers, doubles, logicals, strings)</li>
<li>Lists (named and unnamed)</li>
<li>Data frames</li>
<li>Error handling (stop, warning, message)</li>
<li>C++ side unit tests with testthat</li>
<li>Roxygen documentation</li>
</ul>
</div>
<div class="section level2">
<h2 id="useful-rc-integration-examples">Useful R/C++ Integration Examples<a class="anchor" aria-label="anchor" href="#useful-rc-integration-examples"></a>
</h2>
<p>Here are some examples of C++ code integration with R using the
<code>cpp11</code> package:</p>
<ul>
<li>
<a href="https://arrow.apache.org/docs/r/">arrow</a>: An R package
that provides bindings to the Arrow C++ library. Arrow is a<br>
columnar in-memory analytics format that is extremely fast and
efficient.</li>
<li>
<a href="https://github.com/pachadotdev/cpp11armadillo">cpp4rarmadillo</a>:
An R package that provides bindings to the Armadillo C++ library.
Armadillo is a high-quality linear algebra library with a syntax similar
to MATLAB.</li>
<li>
<a href="https://github.com/pachadotdev/cpp11eigen">cpp11eigen</a>:
An R package that provides bindings to the Eigen C++ library. Eigen is a
high-performance linear algebra library with a permissive license.</li>
<li>
<a href="https://github.com/tidyverse/haven">haven</a>: A package
that reads and writes SPSS, Stata, and SAS files in R.</li>
<li>
<a href="https://github.com/pachadotdev/kendallknight">kendallknight</a>:
Implements the Kendall’s correlation coefficient in C++, achieving
speedup by using an algorithm with a complexity of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>n</mi><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>n</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">O(n \log(n))</annotation></semantics></math>
instead of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>n</mi><mn>2</mn></msup><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">O(n^2)</annotation></semantics></math>
in base R.</li>
<li>
<a href="https://github.com/amices/mice">mice</a>: A package that
imputes missing data using multivariate chained equations.</li>
<li>
<a href="https://github.com/pachadotdev/open-redatam">redatam</a>:
C++ implementation of the Redatam file format, callable from both R and
Python.</li>
<li>
<a href="https://github.com/r-dbi/RPostgres">RPostgres</a>: A C++
interface to PostgreSQL using <code>cpp4r</code>.</li>
<li>
<a href="https://github.com/tidyverse/tidyr/">tidyr</a>: A package
that uses C++ functions to reshape data frames.</li>
</ul>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Mauricio Vargas Sepulveda, Posit Software, PBC.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
